<!-- Payment Modal Component -->
<div class="modal-overlay" id="paymentModal" style="display: none;">
    <div class="modal-container payment-modal">
        <div class="modal-header">
            <h2>üí≥ M√©todo de Pago</h2>
            <button class="modal-close" id="closePaymentModal">‚úï</button>
        </div>
        
        <div class="modal-body">
            <!-- Resumen del pedido -->
            <div class="payment-summary">
                <h3>üì¶ Resumen del Pedido</h3>
                <div class="summary-items" id="paymentSummaryItems">
                    <!-- Se llenar√° din√°micamente -->
                </div>
                <div class="summary-totals">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="paymentSubtotal">0.00‚Ç¨</span>
                    </div>
                    <div class="summary-row" id="paymentFeeRow" style="display: none;">
                        <span>Gastos de gesti√≥n:</span>
                        <span id="paymentFee">0.00‚Ç¨</span>
                    </div>
                    <div class="summary-row total">
                        <strong>Total:</strong>
                        <strong id="paymentTotal">0.00‚Ç¨</strong>
                    </div>
                </div>
            </div>

            <!-- Selector de m√©todo de pago -->
            <div class="payment-methods">
                <h3>üè¶ Seleccione el m√©todo de pago</h3>
                <div class="payment-method-list" id="paymentMethodList">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>

            <!-- Formulario de tarjeta (Stripe) -->
            <div class="payment-form card-form" id="cardPaymentForm" style="display: none;">
                <h3>üí≥ Datos de la Tarjeta</h3>
                <div id="card-element" class="card-element">
                    <!-- Stripe Elements se montar√° aqu√≠ -->
                </div>
                <div id="card-errors" class="payment-errors"></div>
            </div>

            <!-- Instrucciones Bizum -->
            <div class="payment-form bizum-form" id="bizumPaymentForm" style="display: none;">
                <h3>üì± Pago con Bizum</h3>
                <div class="bizum-instructions">
                    <div class="bizum-step">
                        <span class="step-number">1</span>
                        <p>Abra la app de su banco</p>
                    </div>
                    <div class="bizum-step">
                        <span class="step-number">2</span>
                        <p>Seleccione "Enviar Bizum"</p>
                    </div>
                    <div class="bizum-step">
                        <span class="step-number">3</span>
                        <p>Env√≠e <strong id="bizumAmount">0.00‚Ç¨</strong> al n√∫mero:</p>
                        <div class="bizum-phone" id="bizumPhone">---</div>
                    </div>
                    <div class="bizum-step">
                        <span class="step-number">4</span>
                        <p>Use como concepto el c√≥digo:</p>
                        <div class="bizum-code" id="bizumCode">---</div>
                    </div>
                </div>
                <p class="payment-note">‚è±Ô∏è Una vez realizado el pago, puede tardar hasta 24h en confirmarse</p>
            </div>

            <!-- Instrucciones Transferencia -->
            <div class="payment-form transfer-form" id="transferPaymentForm" style="display: none;">
                <h3>üè¶ Transferencia Bancaria</h3>
                <div class="bank-details">
                    <div class="bank-detail-item">
                        <label>Beneficiario:</label>
                        <div class="detail-value" id="transferBeneficiary">Econom√≠a Circular Canarias</div>
                    </div>
                    <div class="bank-detail-item">
                        <label>IBAN:</label>
                        <div class="detail-value" id="transferIBAN">ES00 0000 0000 0000 0000 0000</div>
                        <button class="btn-copy" onclick="navigator.clipboard.writeText(document.getElementById('transferIBAN').textContent)">üìã Copiar</button>
                    </div>
                    <div class="bank-detail-item">
                        <label>Concepto:</label>
                        <div class="detail-value" id="transferReference">PEDIDO-XXXXX</div>
                        <button class="btn-copy" onclick="navigator.clipboard.writeText(document.getElementById('transferReference').textContent)">üìã Copiar</button>
                    </div>
                    <div class="bank-detail-item">
                        <label>Importe:</label>
                        <div class="detail-value" id="transferAmount">0.00‚Ç¨</div>
                    </div>
                </div>
                <p class="payment-note">‚è±Ô∏è El pedido se procesar√° una vez confirmemos la transferencia (24-48h)</p>
            </div>

            <!-- Instrucciones PayPal -->
            <div class="payment-form paypal-form" id="paypalPaymentForm" style="display: none;">
                <h3>üÖøÔ∏è Pago con PayPal</h3>
                <p>Ser√° redirigido a PayPal para completar el pago de forma segura.</p>
                <div id="paypal-button-container"></div>
            </div>

            <!-- Instrucciones Contrarreembolso -->
            <div class="payment-form cod-form" id="codPaymentForm" style="display: none;">
                <h3>üíµ Pago Contrarreembolso</h3>
                <div class="cod-instructions">
                    <p>üì¶ Recibir√° su pedido en la direcci√≥n indicada</p>
                    <p>üí∞ Pagar√° en efectivo al repartidor al momento de la entrega</p>
                    <p class="cod-warning">‚ö†Ô∏è Gastos de gesti√≥n: <strong>3.00‚Ç¨</strong></p>
                    <p class="cod-note">üí° Prepare el importe exacto para facilitar la entrega</p>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelPaymentBtn">‚ùå Cancelar</button>
            <button class="btn btn-primary" id="confirmPaymentBtn" disabled>
                üí≥ Pagar <span id="confirmPaymentAmount">0.00‚Ç¨</span>
            </button>
        </div>

        <!-- Indicador de carga -->
        <div class="payment-loading" id="paymentLoading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>Procesando pago...</p>
        </div>
    </div>
</div>
