<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EconomÃ­a Circular de Canarias | Productos Locales</title>
    <meta name="description" content="Descubre la EconomÃ­a Circular en Canarias con Productos Locales y Sostenibles. Apoya a los Productores Canarios y Fomenta un Consumo Responsable. Si Compras AquÃ­, Vuelve a Ti.">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸï¸</text></svg>">
    <!-- Estilos principales -->
    <link rel="stylesheet" href="app/assets/css/styles.css">
</head>
<body data-theme="light">
    <!-- Contenedor principal de la aplicaciÃ³n Angular-style -->
    <div id="app-root">
        <!-- Pantalla de carga inicial -->
        <div class="loading-screen">
            <div class="loading-emoji">ğŸï¸</div>
            <h1 class="loading-title">EconomÃ­a Circular Canarias</h1>
            <div class="loading-bar-container">
                <div class="loading-bar"></div>
            </div>
            <p class="loading-text">Cargando aplicaciÃ³n...</p>
        </div>
    </div>
    <!-- Scripts esenciales de la aplicaciÃ³n -->
    <!-- 1. ConfiguraciÃ³n base -->
    <script src="app/config/app.config.js"></script>
    <!-- 2. Servicios fundamentales -->
    <script src="app/services/auth.service.js"></script>
    <script src="app/services/cart.service.js"></script>
    <script src="app/services/payment.service.js"></script>
    <!-- 3. Componentes globales requeridos -->
    <script src="app/components/modals/email-confirmation-modal.component.js"></script>
    <script src="app/components/modals/logout-modal.component.js"></script>
    <script src="app/components/modals/notification-modal.component.js"></script>
    <script src="app/components/modals/payment-modal.component.js"></script>
    <script src="app/components/cart/cart-modal.component.js"></script>
    <!-- 4. InicializaciÃ³n asÃ­ncrona de AuthService -->
    <script>
        // FunciÃ³n simple para verificar sesiÃ³n al cargar la pÃ¡gina
        document.addEventListener('DOMContentLoaded', async function() {
            // Esperar un momento para que todos los scripts se carguen
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // FunciÃ³n para obtener cookie
            function getCookie(name) {
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [cookieName, cookieValue] = cookie.trim().split('=');
                    if (cookieName === name) {
                        return cookieValue;
                    }
                }
                // MÃ©todo alternativo con regex
                const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
                return match ? match[2] : null;
            }
            
            const token = getCookie('ecc_auth_token');
            
            if (token) {
                console.log('ğŸª Token encontrado, inicializando sesiÃ³n...');
                
                // Crear AuthService si no existe
                if (!window.authService && window.AuthService) {
                    window.authService = new window.AuthService();
                    const sessionRestored = await window.authService.init();
                    
                    // Forzar actualizaciÃ³n del header despuÃ©s de la inicializaciÃ³n
                    setTimeout(() => {
                        if (window.headerComponent && sessionRestored) {
                            window.headerComponent.refreshAuthState();
                            console.log('ğŸ”„ Header actualizado despuÃ©s de restaurar sesiÃ³n');
                        }
                    }, 100);
                }
            }
        });
    </script>
    <!-- 5. Componentes de layout -->
    <script src="app/components/header/header.component.js"></script>
    <script src="app/components/nav/nav.component.js"></script>
    <script src="app/components/footer/footer.component.js"></script>
    <!-- 6. PÃ¡ginas principales -->
    <script src="app/pages/home/home.component.js"></script>
    <script src="app/pages/products/products.component.js"></script>
    <script src="app/pages/auth/login/login.component.js"></script>
    <script src="app/pages/auth/register/register.component.js"></script>
    <script src="app/pages/profile/profile.component.js"></script>
    <script src="app/pages/orders/orders.component.js"></script>
    <!-- 7. Router y aplicaciÃ³n principal -->
    <script src="app/router/app-router.js"></script>
    <script src="app/app.component.js"></script>
    <!-- 8. InicializaciÃ³n -->
    <script src="app/assets/js/main.js"></script>
</body>
</html>